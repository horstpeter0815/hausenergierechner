<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hausenergierechner</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg-dark: #0a0f1a;
      --bg-card: #111827;
      --bg-input: #1f2937;
      --border: #374151;
      --text: #f3f4f6;
      --text-muted: #9ca3af;
      --text-dim: #6b7280;
      --accent: #10b981;
      --accent-glow: rgba(16, 185, 129, 0.15);
      --warning: #f59e0b;
      --danger: #ef4444;
      --success: #22c55e;
      --blue: #3b82f6;
      --purple: #8b5cf6;
      --orange: #f97316;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-dark);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem;
    }

    header {
      text-align: center;
      margin-bottom: 2rem;
      padding: 1.5rem 0;
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--accent) 0%, #34d399 50%, #a7f3d0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    header p {
      color: var(--text-muted);
      margin-top: 0.5rem;
    }

    /* Progress Bar */
    .progress-container {
      margin-bottom: 2rem;
    }

    .progress-steps {
      display: flex;
      justify-content: space-between;
      position: relative;
      margin-bottom: 0.5rem;
    }

    .progress-steps::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--border);
      transform: translateY(-50%);
      z-index: 0;
    }

    .progress-step {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--bg-card);
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.875rem;
      z-index: 1;
      transition: all 0.3s;
      cursor: pointer;
    }

    .progress-step.active {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--bg-dark);
    }

    .progress-step.completed {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--bg-dark);
    }

    .progress-labels {
      display: flex;
      justify-content: space-between;
    }

    .progress-label {
      font-size: 0.75rem;
      color: var(--text-dim);
      text-align: center;
      width: 80px;
      margin-left: -22px;
    }

    .progress-label:first-child { margin-left: 0; }
    .progress-label.active { color: var(--accent); font-weight: 600; }

    /* Wizard Card */
    .wizard-card {
      background: var(--bg-card);
      border-radius: 20px;
      border: 1px solid var(--border);
      padding: 2rem;
      min-height: 400px;
      display: flex;
      flex-direction: column;
    }

    .step { display: none; flex-direction: column; flex: 1; }
    .step.active { display: flex; }

    .step-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .step-subtitle {
      color: var(--text-muted);
      margin-bottom: 2rem;
    }

    .step-content { flex: 1; }

    /* Input Groups */
    .input-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .input-group { margin-bottom: 1.25rem; }

    label {
      display: block;
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }

    .input-wrapper {
      display: flex;
      align-items: stretch;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .input-wrapper:focus-within {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }

    input[type="number"], input[type="text"], select {
      flex: 1;
      background: transparent;
      border: none;
      padding: 0.875rem 1rem;
      color: var(--text);
      font-family: 'JetBrains Mono', monospace;
      font-size: 1rem;
      outline: none;
    }

    select { cursor: pointer; }

    .unit {
      display: flex;
      align-items: center;
      padding: 0 1rem;
      background: rgba(255,255,255,0.03);
      color: var(--text-dim);
      font-size: 0.8125rem;
      font-family: 'JetBrains Mono', monospace;
      border-left: 1px solid var(--border);
      min-width: 70px;
      justify-content: center;
    }

    /* Technology Selection */
    .tech-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    @media (max-width: 600px) {
      .tech-grid { grid-template-columns: 1fr; }
    }

    .tech-card {
      background: var(--bg-input);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .tech-card:hover {
      border-color: var(--text-dim);
    }

    .tech-card.selected {
      border-color: var(--accent);
      background: var(--accent-glow);
    }

    .tech-card.selected.tech-b {
      border-color: var(--blue);
      background: rgba(59, 130, 246, 0.15);
    }

    .tech-icon {
      font-size: 2.5rem;
      margin-bottom: 0.75rem;
    }

    .tech-name {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.25rem;
    }

    .tech-desc {
      font-size: 0.8125rem;
      color: var(--text-dim);
    }

    /* Navigation */
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
    }

    .btn {
      padding: 0.875rem 2rem;
      border-radius: 10px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      font-family: inherit;
    }

    .btn-secondary {
      background: var(--bg-input);
      color: var(--text-muted);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border);
      color: var(--text);
    }

    .btn-primary {
      background: var(--accent);
      color: var(--bg-dark);
    }

    .btn-primary:hover {
      background: #0d9668;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Results */
    .results-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    @media (max-width: 700px) {
      .results-grid { grid-template-columns: 1fr; }
    }

    .result-box {
      background: var(--bg-input);
      border-radius: 16px;
      padding: 1.5rem;
      border: 2px solid transparent;
    }

    .result-box.tech-a {
      border-color: var(--orange);
    }

    .result-box.tech-b {
      border-color: var(--accent);
    }

    .result-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .result-icon { font-size: 1.5rem; }

    .result-title {
      font-weight: 600;
      font-size: 1rem;
    }

    .result-rows { }

    .result-row {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--border);
      font-size: 0.9375rem;
    }

    .result-row:last-child { border-bottom: none; }

    .result-label { color: var(--text-muted); }

    .result-value {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 500;
    }

    .result-total {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 2px solid var(--border);
      display: flex;
      justify-content: space-between;
      font-size: 1.125rem;
      font-weight: 700;
    }

    .result-total .result-value {
      font-size: 1.25rem;
    }

    /* Comparison Summary */
    .comparison-summary {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
      border-radius: 16px;
      padding: 1.5rem;
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .savings-label {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }

    .savings-value {
      font-size: 2.5rem;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .savings-value.positive { color: var(--success); }
    .savings-value.negative { color: var(--danger); }

    .savings-note {
      font-size: 0.8125rem;
      color: var(--text-dim);
      margin-top: 0.5rem;
    }

    /* Chart */
    .chart-container {
      height: 280px;
      margin: 1.5rem 0;
    }

    /* Recommendation */
    .recommendation {
      background: var(--bg-input);
      border-radius: 16px;
      padding: 1.5rem;
      display: flex;
      align-items: flex-start;
      gap: 1rem;
    }

    .rec-icon {
      font-size: 2rem;
      flex-shrink: 0;
    }

    .rec-text h4 {
      font-size: 1rem;
      margin-bottom: 0.25rem;
    }

    .rec-text p {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 2rem 0 1rem;
      color: var(--text-dim);
      font-size: 0.75rem;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .step.active {
      animation: fadeIn 0.3s ease-out;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üè† Hausenergierechner</h1>
      <p>Vergleiche deine Heizkosten ‚Äì in 4 einfachen Schritten</p>
    </header>

    <!-- Progress -->
    <div class="progress-container">
      <div class="progress-steps">
        <div class="progress-step active" data-step="1">1</div>
        <div class="progress-step" data-step="2">2</div>
        <div class="progress-step" data-step="3">3</div>
        <div class="progress-step" data-step="4">4</div>
      </div>
      <div class="progress-labels">
        <span class="progress-label active">Geb√§ude</span>
        <span class="progress-label">Technologie A</span>
        <span class="progress-label">Technologie B</span>
        <span class="progress-label">Ergebnis</span>
      </div>
    </div>

    <!-- Wizard Card -->
    <div class="wizard-card">
      
      <!-- Step 1: Building Data -->
      <div class="step active" data-step="1">
        <h2 class="step-title">Erz√§hl mir von deinem Haus</h2>
        <p class="step-subtitle">Diese Daten brauche ich f√ºr die Berechnung</p>
        
        <div class="step-content">
          <div class="input-row">
            <div class="input-group">
              <label>Wohnfl√§che (beheizt)</label>
              <div class="input-wrapper">
                <input type="number" id="wohnflaeche" value="150" min="20" max="1000">
                <span class="unit">m¬≤</span>
              </div>
            </div>
            <div class="input-group">
              <label>Baujahr / Sanierungsstand</label>
              <div class="input-wrapper">
                <select id="gebaeudealter">
                  <option value="alt">Altbau (vor 1980, unsaniert)</option>
                  <option value="teilsaniert" selected>Teilsaniert (1980-2000)</option>
                  <option value="saniert">Saniert / gut ged√§mmt</option>
                  <option value="neubau">Neubau / Passivhaus</option>
                </select>
              </div>
            </div>
          </div>

          <div class="input-row">
            <div class="input-group">
              <label>Anzahl Bewohner</label>
              <div class="input-wrapper">
                <input type="number" id="bewohner" value="4" min="1" max="10">
                <span class="unit">Pers.</span>
              </div>
            </div>
            <div class="input-group">
              <label>Heiz√∂lverbrauch (falls bekannt)</label>
              <div class="input-wrapper">
                <input type="number" id="oelverbrauch" value="2500" min="0" max="20000" step="100">
                <span class="unit">Liter/a</span>
              </div>
            </div>
          </div>

          <div class="input-row">
            <div class="input-group">
              <label>Stromverbrauch Haushalt</label>
              <div class="input-wrapper">
                <input type="number" id="stromverbrauch" value="3500" min="500" max="20000" step="100">
                <span class="unit">kWh/a</span>
              </div>
            </div>
            <div class="input-group">
              <label>E-Auto geplant?</label>
              <div class="input-wrapper">
                <select id="eauto">
                  <option value="0">Nein</option>
                  <option value="2500">Ja, ~10.000 km/Jahr</option>
                  <option value="5000">Ja, ~20.000 km/Jahr</option>
                </select>
              </div>
            </div>
          </div>

          <div class="input-row">
            <div class="input-group">
              <label>ü¶∂ Fu√übodenheizung vorhanden?</label>
              <div class="input-wrapper">
                <select id="fussbodenheizung">
                  <option value="0">Nein (Heizk√∂rper/Radiatoren)</option>
                  <option value="1" selected>Ja, Fu√übodenheizung</option>
                  <option value="2">Teilweise (gemischt)</option>
                </select>
              </div>
            </div>
          </div>

          <div class="input-row">
            <div class="input-group">
              <label>üß≠ Dachausrichtung (f√ºr PV)</label>
              <div class="input-wrapper">
                <select id="dachausrichtung">
                  <option value="1.0">S√ºd (optimal)</option>
                  <option value="0.95" selected>S√ºdost / S√ºdwest</option>
                  <option value="0.85">Ost / West</option>
                  <option value="0.70">Nordost / Nordwest</option>
                  <option value="0.55">Nord (ung√ºnstig)</option>
                </select>
              </div>
            </div>
            <div class="input-group">
              <label>üìê Dachneigung</label>
              <div class="input-wrapper">
                <select id="dachneigung">
                  <option value="0.87">Flachdach (0-10¬∞)</option>
                  <option value="0.95">15¬∞</option>
                  <option value="1.0" selected>30¬∞ (optimal)</option>
                  <option value="0.98">45¬∞</option>
                  <option value="0.90">60¬∞ (steil)</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="nav-buttons">
          <div></div>
          <button class="btn btn-primary" onclick="nextStep()">Weiter ‚Üí</button>
        </div>
      </div>

      <!-- Step 2: Technology A (Current) -->
      <div class="step" data-step="2">
        <h2 class="step-title">Deine aktuelle Heizung</h2>
        <p class="step-subtitle">Was hast du jetzt ‚Äì oder was willst du vergleichen?</p>
        
        <div class="step-content">
          <div class="tech-grid">
            <div class="tech-card selected" data-tech-a="oel">
              <div class="tech-icon">üõ¢Ô∏è</div>
              <div class="tech-name">√ñlheizung</div>
              <div class="tech-desc">Klassischer √ñlkessel</div>
            </div>
            <div class="tech-card" data-tech-a="gas">
              <div class="tech-icon">üî•</div>
              <div class="tech-name">Gasheizung</div>
              <div class="tech-desc">Erdgas-Brennwert</div>
            </div>
            <div class="tech-card" data-tech-a="pellets">
              <div class="tech-icon">ü™µ</div>
              <div class="tech-name">Pelletheizung</div>
              <div class="tech-desc">Holzpellets</div>
            </div>
            <div class="tech-card" data-tech-a="strom">
              <div class="tech-icon">‚ö°</div>
              <div class="tech-name">Nachtspeicher</div>
              <div class="tech-desc">Elektro-Direktheizung</div>
            </div>
          </div>

          <div class="input-row">
            <div class="input-group">
              <label id="preisA_label">Heiz√∂lpreis aktuell</label>
              <div class="input-wrapper">
                <input type="number" id="preisA" value="1.05" min="0.5" max="3" step="0.01">
                <span class="unit" id="preisA_unit">‚Ç¨/Liter</span>
              </div>
            </div>
            <div class="input-group">
              <label>Alter der Heizung</label>
              <div class="input-wrapper">
                <select id="heizungAlter">
                  <option value="neu">Neu (< 5 Jahre)</option>
                  <option value="mittel">Mittelalt (5-15 Jahre)</option>
                  <option value="alt" selected>Alt (> 15 Jahre)</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="nav-buttons">
          <button class="btn btn-secondary" onclick="prevStep()">‚Üê Zur√ºck</button>
          <button class="btn btn-primary" onclick="nextStep()">Weiter ‚Üí</button>
        </div>
      </div>

      <!-- Step 3: Technology B (New) -->
      <div class="step" data-step="3">
        <h2 class="step-title">Die Alternative</h2>
        <p class="step-subtitle">Womit m√∂chtest du vergleichen?</p>
        
        <div class="step-content">
          <div class="tech-grid">
            <div class="tech-card tech-b" data-tech-b="pv_only">
              <div class="tech-icon">‚òÄÔ∏è</div>
              <div class="tech-name">Nur PV-Anlage</div>
              <div class="tech-desc">Heizung behalten</div>
            </div>
            <div class="tech-card tech-b selected" data-tech-b="wp_pv">
              <div class="tech-icon">‚òÄÔ∏èüå°Ô∏è</div>
              <div class="tech-name">W√§rmepumpe + PV</div>
              <div class="tech-desc">Komplett-Umstieg</div>
            </div>
            <div class="tech-card tech-b" data-tech-b="wp">
              <div class="tech-icon">üå°Ô∏è</div>
              <div class="tech-name">Nur W√§rmepumpe</div>
              <div class="tech-desc">Ohne PV</div>
            </div>
            <div class="tech-card tech-b" data-tech-b="pellets_neu">
              <div class="tech-icon">ü™µ</div>
              <div class="tech-name">Pelletheizung</div>
              <div class="tech-desc">Holzpellets</div>
            </div>
          </div>

          <div class="input-row" id="wpOptions" style="display: block;">
            <div class="input-group">
              <label>Erwartete Jahresarbeitszahl (COP)</label>
              <div class="input-wrapper">
                <select id="cop">
                  <option value="2.5">2,5 (Altbau, Radiatoren)</option>
                  <option value="3.0">3,0 (Teilsaniert)</option>
                  <option value="3.5" selected>3,5 (Gut ged√§mmt, Fu√übodenheizung)</option>
                  <option value="4.0">4,0 (Neubau/Passivhaus)</option>
                </select>
              </div>
            </div>
          </div>

          <div class="input-row" id="pvOptions" style="display: none;">
            <div class="input-group">
              <label>PV-Anlagengr√∂√üe</label>
              <div class="input-wrapper">
                <input type="number" id="pvGroesse" value="10" min="3" max="30" step="1">
                <span class="unit">kWp</span>
              </div>
            </div>
            <div class="input-group">
              <label>Batteriespeicher</label>
              <div class="input-wrapper">
                <input type="number" id="batterie" value="0" min="0" max="20" step="1">
                <span class="unit">kWh</span>
              </div>
            </div>
          </div>

          <!-- Editierbare Investitionskosten -->
          <div style="margin-top: 1rem; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 12px; border: 1px dashed rgba(139, 92, 246, 0.3);">
            <div style="font-size: 0.75rem; color: var(--purple); font-weight: 600; margin-bottom: 0.75rem;">üí∞ INVESTITIONSKOSTEN (aus Angebot √ºberschreiben)</div>
            <div class="input-row" id="kostenInputs">
              <div class="input-group" id="wpKostenGroup">
                <label>W√§rmepumpe (inkl. Installation)</label>
                <div class="input-wrapper">
                  <input type="number" id="wpKosten" value="18000" min="0" max="50000" step="500" placeholder="auto">
                  <span class="unit">‚Ç¨</span>
                </div>
              </div>
              <div class="input-group" id="pvKostenGroup">
                <label>PV-Anlage (inkl. Installation)</label>
                <div class="input-wrapper">
                  <input type="number" id="pvKosten" value="14000" min="0" max="50000" step="500" placeholder="auto">
                  <span class="unit">‚Ç¨</span>
                </div>
              </div>
            </div>
            <div class="input-row">
              <div class="input-group" id="batterieKostenGroup" style="display: none;">
                <label>Batteriespeicher</label>
                <div class="input-wrapper">
                  <input type="number" id="batterieKosten" value="0" min="0" max="20000" step="500" placeholder="auto">
                  <span class="unit">‚Ç¨</span>
                </div>
              </div>
            </div>
            <div style="font-size: 0.7rem; color: var(--text-dim); margin-top: 0.5rem;">
              üí° Standardwerte basieren auf Durchschnittspreisen. Trag hier dein echtes Angebot ein!
            </div>
          </div>

          <div class="input-row">
            <div class="input-group">
              <label>Strompreis</label>
              <div class="input-wrapper">
                <input type="number" id="strompreis" value="0.32" min="0.15" max="0.60" step="0.01">
                <span class="unit">‚Ç¨/kWh</span>
              </div>
            </div>
            <div class="input-group">
              <label>Preissteigerung/Jahr (gesch√§tzt)</label>
              <div class="input-wrapper">
                <input type="number" id="preissteigerung" value="3" min="-2" max="10" step="0.5">
                <span class="unit">%</span>
              </div>
            </div>
          </div>

          <!-- KfW/BAFA F√∂rderung -->
          <div class="input-row" id="foerderungOptions">
            <div class="input-group" style="flex: 2;">
              <label>üèõÔ∏è KfW/BAFA Heizungsf√∂rderung (2024)</label>
              <div class="input-wrapper">
                <select id="foerderung">
                  <option value="0">Keine F√∂rderung</option>
                  <option value="30">30% Grundf√∂rderung (W√§rmepumpe)</option>
                  <option value="50" selected>50% (Grund + Klima-Geschwindigkeitsbonus)</option>
                  <option value="55">55% (+ Einkommensbonus bis 40k‚Ç¨)</option>
                  <option value="70">70% Maximum (alle Boni)</option>
                </select>
              </div>
            </div>
          </div>
          <div style="font-size: 0.75rem; color: var(--text-dim); margin-top: -0.5rem; margin-bottom: 1rem; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
            üí° <strong>Tipp:</strong> Die F√∂rderung gilt f√ºr W√§rmepumpen beim Austausch fossiler Heizungen. Klima-Geschwindigkeitsbonus (20%) bei Austausch vor 2028, Einkommensbonus (30%) bei zu versteuerndem Einkommen unter 40.000‚Ç¨. Max. f√∂rderf√§hige Kosten: 30.000‚Ç¨ f√ºr erste Wohneinheit.
          </div>
        </div>

        <div class="nav-buttons">
          <button class="btn btn-secondary" onclick="prevStep()">‚Üê Zur√ºck</button>
          <button class="btn btn-primary" onclick="calculateAndShow()">Berechnen! üöÄ</button>
        </div>
      </div>

      <!-- Step 4: Results -->
      <div class="step" data-step="4">
        <h2 class="step-title">Dein Ergebnis</h2>
        <p class="step-subtitle">20-Jahres-Kostenvergleich</p>
        
        <div class="step-content">
          <!-- Comparison Summary -->
          <div class="comparison-summary">
            <div class="savings-label">Ersparnis mit <span id="techBName">W√§rmepumpe + PV</span> √ºber 20 Jahre:</div>
            <div class="savings-value positive" id="totalSavings">+45.230 ‚Ç¨</div>
            <div class="savings-note" id="savingsNote">Das entspricht 2.261 ‚Ç¨ pro Jahr</div>
          </div>

          <!-- Two columns -->
          <div class="results-grid">
            <div class="result-box tech-a">
              <div class="result-header">
                <span class="result-icon" id="iconA">üõ¢Ô∏è</span>
                <span class="result-title" id="titleA">√ñlheizung (aktuell)</span>
              </div>
              <div class="result-rows">
                <div class="result-row">
                  <span class="result-label">Brennstoffkosten/Jahr</span>
                  <span class="result-value" id="fuelCostA">2.625 ‚Ç¨</span>
                </div>
                <div class="result-row">
                  <span class="result-label">Stromkosten/Jahr</span>
                  <span class="result-value" id="elecCostA">1.120 ‚Ç¨</span>
                </div>
                <div class="result-row">
                  <span class="result-label">Wartung/Jahr</span>
                  <span class="result-value" id="maintCostA">300 ‚Ç¨</span>
                </div>
                <div class="result-row">
                  <span class="result-label">Investition</span>
                  <span class="result-value" id="investA">0 ‚Ç¨</span>
                </div>
              </div>
              <div class="result-total">
                <span>Gesamt 20 Jahre</span>
                <span class="result-value" id="totalA">98.450 ‚Ç¨</span>
              </div>
            </div>

            <div class="result-box tech-b">
              <div class="result-header">
                <span class="result-icon" id="iconB">‚òÄÔ∏èüå°Ô∏è</span>
                <span class="result-title" id="titleB">W√§rmepumpe + PV</span>
              </div>
              <div class="result-rows">
                <div class="result-row">
                  <span class="result-label">Stromkosten/Jahr</span>
                  <span class="result-value" id="elecCostB">890 ‚Ç¨</span>
                </div>
                <div class="result-row">
                  <span class="result-label">Einspeiseverg√ºtung/Jahr</span>
                  <span class="result-value" id="feedInB">-410 ‚Ç¨</span>
                </div>
                <div class="result-row">
                  <span class="result-label">Wartung/Jahr</span>
                  <span class="result-value" id="maintCostB">150 ‚Ç¨</span>
                </div>
                <div class="result-row">
                  <span class="result-label">Investition (brutto)</span>
                  <span class="result-value" id="investBrutto">35.000 ‚Ç¨</span>
                </div>
                <div class="result-row" id="foerderungRow" style="color: var(--success);">
                  <span class="result-label">üèõÔ∏è KfW/BAFA F√∂rderung</span>
                  <span class="result-value" id="foerderungBetrag">-15.000 ‚Ç¨</span>
                </div>
                <div class="result-row" style="font-weight: 600;">
                  <span class="result-label">Investition (netto)</span>
                  <span class="result-value" id="investB">20.000 ‚Ç¨</span>
                </div>
              </div>
              <div class="result-total">
                <span>Gesamt 20 Jahre</span>
                <span class="result-value" id="totalB">53.220 ‚Ç¨</span>
              </div>
            </div>
          </div>

          <!-- Chart -->
          <div class="chart-container">
            <canvas id="comparisonChart"></canvas>
          </div>

          <!-- Recommendation -->
          <div class="recommendation">
            <div class="rec-icon" id="recIcon">üí°</div>
            <div class="rec-text">
              <h4 id="recTitle">Empfehlung</h4>
              <p id="recText">Die W√§rmepumpe mit PV-Anlage amortisiert sich nach etwa 8 Jahren und spart danach jedes Jahr bares Geld. Zus√§tzlich reduzierst du deinen CO‚ÇÇ-Aussto√ü um ca. 4,5 Tonnen pro Jahr.</p>
            </div>
          </div>
        </div>

        <div class="nav-buttons">
          <button class="btn btn-secondary" onclick="prevStep()">‚Üê Zur√ºck</button>
          <button class="btn btn-primary" onclick="restartWizard()">üîÑ Neu berechnen</button>
        </div>
      </div>

    </div>

    <footer>
      Hausenergierechner ‚Ä¢ Vereinfachte Berechnung ‚Ä¢ Keine Gew√§hr
    </footer>
  </div>

  <script>
    let currentStep = 1;
    let selectedTechA = 'oel';
    let selectedTechB = 'wp_pv';
    let comparisonChart = null;

    // Tech card selection
    document.querySelectorAll('.tech-card[data-tech-a]').forEach(card => {
      card.addEventListener('click', () => {
        document.querySelectorAll('.tech-card[data-tech-a]').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        selectedTechA = card.dataset.techA;
        updateTechAUI();
      });
    });

    document.querySelectorAll('.tech-card[data-tech-b]').forEach(card => {
      card.addEventListener('click', () => {
        document.querySelectorAll('.tech-card[data-tech-b]').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        selectedTechB = card.dataset.techB;
        updateTechBUI();
      });
    });

    function updateTechAUI() {
      const preisLabel = document.getElementById('preisA_label');
      const preisUnit = document.getElementById('preisA_unit');
      const preisInput = document.getElementById('preisA');
      
      switch(selectedTechA) {
        case 'oel':
          preisLabel.textContent = 'Heiz√∂lpreis aktuell';
          preisUnit.textContent = '‚Ç¨/Liter';
          preisInput.value = '1.05';
          break;
        case 'gas':
          preisLabel.textContent = 'Gaspreis aktuell';
          preisUnit.textContent = '‚Ç¨/kWh';
          preisInput.value = '0.12';
          break;
        case 'pellets':
          preisLabel.textContent = 'Pelletpreis aktuell';
          preisUnit.textContent = '‚Ç¨/kg';
          preisInput.value = '0.35';
          break;
        case 'strom':
          preisLabel.textContent = 'Strompreis aktuell';
          preisUnit.textContent = '‚Ç¨/kWh';
          preisInput.value = '0.32';
          break;
      }
    }

    function updateTechBUI() {
      const wpOptions = document.getElementById('wpOptions');
      const pvOptions = document.getElementById('pvOptions');
      const foerderungOptions = document.getElementById('foerderungOptions');
      const wpKostenGroup = document.getElementById('wpKostenGroup');
      const pvKostenGroup = document.getElementById('pvKostenGroup');
      const batterieKostenGroup = document.getElementById('batterieKostenGroup');
      
      // Show COP options only for heat pump options
      if (selectedTechB === 'wp' || selectedTechB === 'wp_pv') {
        wpOptions.style.display = 'block';
      } else {
        wpOptions.style.display = 'none';
      }
      
      // Show PV options for PV-only and WP+PV
      if (selectedTechB === 'wp_pv' || selectedTechB === 'pv_only') {
        pvOptions.style.display = 'flex';
      } else {
        pvOptions.style.display = 'none';
      }
      
      // Show F√∂rderung only for heat pump options (not for PV-only)
      if (foerderungOptions) {
        if (selectedTechB === 'wp' || selectedTechB === 'wp_pv') {
          foerderungOptions.style.display = 'block';
        } else {
          foerderungOptions.style.display = 'none';
        }
      }
      
      // Show/hide cost input groups based on selected tech
      if (wpKostenGroup) {
        wpKostenGroup.style.display = (selectedTechB === 'wp' || selectedTechB === 'wp_pv') ? 'block' : 'none';
      }
      if (pvKostenGroup) {
        pvKostenGroup.style.display = (selectedTechB === 'wp_pv' || selectedTechB === 'pv_only') ? 'block' : 'none';
      }
      if (batterieKostenGroup) {
        const batterie = parseFloat(document.getElementById('batterie').value) || 0;
        batterieKostenGroup.style.display = (batterie > 0 && (selectedTechB === 'wp_pv' || selectedTechB === 'pv_only')) ? 'block' : 'none';
      }
      
      // Update default cost values based on inputs
      updateDefaultCosts();
    }
    
    function updateDefaultCosts() {
      const pvGroesse = parseFloat(document.getElementById('pvGroesse').value) || 10;
      const batterie = parseFloat(document.getElementById('batterie').value) || 0;
      const wohnflaeche = parseFloat(document.getElementById('wohnflaeche').value) || 150;
      
      // Set default values (user can override)
      const wpDefault = 18000 + (wohnflaeche > 150 ? 4000 : 0);
      const pvDefault = Math.round(pvGroesse * 1400);
      const batterieDefault = Math.round(batterie * 800);
      
      // Only update if field is empty or has default placeholder
      const wpInput = document.getElementById('wpKosten');
      const pvInput = document.getElementById('pvKosten');
      const batterieInput = document.getElementById('batterieKosten');
      
      // Update placeholders to show calculated defaults
      wpInput.placeholder = wpDefault + ' (berechnet)';
      pvInput.placeholder = pvDefault + ' (berechnet)';
      batterieInput.placeholder = batterieDefault + ' (berechnet)';
      
      // Show battery cost group if battery > 0
      const batterieKostenGroup = document.getElementById('batterieKostenGroup');
      if (batterieKostenGroup) {
        batterieKostenGroup.style.display = (batterie > 0 && (selectedTechB === 'wp_pv' || selectedTechB === 'pv_only')) ? 'block' : 'none';
      }
    }
    
    // Update costs when PV size or battery changes
    document.getElementById('pvGroesse').addEventListener('input', updateDefaultCosts);
    document.getElementById('batterie').addEventListener('input', updateDefaultCosts);
    document.getElementById('wohnflaeche').addEventListener('input', updateDefaultCosts);

    function updateProgress() {
      document.querySelectorAll('.progress-step').forEach((step, i) => {
        step.classList.remove('active', 'completed');
        if (i + 1 < currentStep) step.classList.add('completed');
        if (i + 1 === currentStep) step.classList.add('active');
      });
      
      document.querySelectorAll('.progress-label').forEach((label, i) => {
        label.classList.remove('active');
        if (i + 1 === currentStep) label.classList.add('active');
      });

      document.querySelectorAll('.step').forEach((step, i) => {
        step.classList.remove('active');
        if (i + 1 === currentStep) step.classList.add('active');
      });
    }

    function nextStep() {
      if (currentStep < 4) {
        currentStep++;
        updateProgress();
      }
    }

    function prevStep() {
      if (currentStep > 1) {
        currentStep--;
        updateProgress();
      }
    }

    function restartWizard() {
      currentStep = 1;
      updateProgress();
    }

    // Calculation
    function getInputs() {
      return {
        wohnflaeche: parseFloat(document.getElementById('wohnflaeche').value) || 150,
        gebaeudealter: document.getElementById('gebaeudealter').value,
        bewohner: parseFloat(document.getElementById('bewohner').value) || 4,
        oelverbrauch: parseFloat(document.getElementById('oelverbrauch').value) || 2500,
        stromverbrauch: parseFloat(document.getElementById('stromverbrauch').value) || 3500,
        eauto: parseFloat(document.getElementById('eauto').value) || 0,
        fussbodenheizung: parseInt(document.getElementById('fussbodenheizung').value) || 0,
        dachausrichtung: parseFloat(document.getElementById('dachausrichtung').value) || 1.0,
        dachneigung: parseFloat(document.getElementById('dachneigung').value) || 1.0,
        preisA: parseFloat(document.getElementById('preisA').value) || 1.05,
        heizungAlter: document.getElementById('heizungAlter').value,
        cop: parseFloat(document.getElementById('cop').value) || 3.5,
        pvGroesse: parseFloat(document.getElementById('pvGroesse').value) || 10,
        batterie: parseFloat(document.getElementById('batterie').value) || 0,
        strompreis: parseFloat(document.getElementById('strompreis').value) || 0.32,
        preissteigerung: parseFloat(document.getElementById('preissteigerung').value) / 100 || 0.03,
        foerderung: parseFloat(document.getElementById('foerderung').value) / 100 || 0,
        // Editable investment costs from real quotes
        wpKosten: parseFloat(document.getElementById('wpKosten').value) || 18000,
        pvKosten: parseFloat(document.getElementById('pvKosten').value) || 14000,
        batterieKosten: parseFloat(document.getElementById('batterieKosten').value) || 0,
      };
    }
    
    // COP adjustment based on heating system
    function getEffectiveCOP(baseCOP, fussbodenheizung) {
      // Fu√übodenheizung works at 35¬∞C, Radiatoren at 55¬∞C
      // This significantly affects heat pump efficiency
      switch(fussbodenheizung) {
        case 0: return baseCOP * 0.75; // Radiatoren: -25% COP
        case 1: return baseCOP * 1.1;  // Fu√übodenheizung: +10% COP  
        case 2: return baseCOP * 0.95; // Gemischt: -5% COP
        default: return baseCOP;
      }
    }
    
    // PV production factor based on roof orientation and tilt
    function getPVFactor(dachausrichtung, dachneigung) {
      // Combined factor for PV production
      // Base: 1050 kWh/kWp for optimal South-facing 30¬∞ roof in BW
      return dachausrichtung * dachneigung;
    }

    function calculateAndShow() {
      const i = getInputs();
      const years = 20;
      
      // Heat demand based on building age and oil consumption
      // 1 Liter Heiz√∂l ‚âà 10 kWh
      let waermebedarfBase = i.oelverbrauch * 10;
      
      // If no oil consumption given, estimate from area
      if (i.oelverbrauch === 0) {
        const faktoren = { alt: 200, teilsaniert: 130, saniert: 80, neubau: 40 };
        waermebedarfBase = i.wohnflaeche * (faktoren[i.gebaeudealter] || 130);
      }
      
      // For year 1 calculation
      let waermebedarf = waermebedarfBase;
      
      // Effective COP based on floor heating
      const effectiveCOP = getEffectiveCOP(i.cop, i.fussbodenheizung);
      
      // PV production factor based on roof
      const pvFaktor = getPVFactor(i.dachausrichtung, i.dachneigung);

      // Total electricity need
      const stromGesamt = i.stromverbrauch + i.eauto;

      // ========== TECHNOLOGY A ==========
      let fuelCostA = 0, elecCostA = 0, maintCostA = 0, investA = 0;
      let techAName = '', techAIcon = '';
      
      switch(selectedTechA) {
        case 'oel':
          techAName = '√ñlheizung (aktuell)';
          techAIcon = 'üõ¢Ô∏è';
          // √ñl: 10 kWh/L, Wirkungsgrad 85%
          const oelBedarf = waermebedarf / 10 / 0.85;
          fuelCostA = oelBedarf * i.preisA;
          elecCostA = stromGesamt * i.strompreis;
          maintCostA = 350;
          investA = i.heizungAlter === 'alt' ? 8000 : 0; // Evtl. bald Austausch n√∂tig
          break;
        case 'gas':
          techAName = 'Gasheizung (aktuell)';
          techAIcon = 'üî•';
          const gasBedarf = waermebedarf / 0.92;
          fuelCostA = gasBedarf * i.preisA;
          elecCostA = stromGesamt * i.strompreis;
          maintCostA = 200;
          investA = 0;
          break;
        case 'pellets':
          techAName = 'Pelletheizung (aktuell)';
          techAIcon = 'ü™µ';
          // 1 kg Pellets ‚âà 5 kWh, Wirkungsgrad 90%
          const pelletBedarf = waermebedarf / 5 / 0.9;
          fuelCostA = pelletBedarf * i.preisA;
          elecCostA = stromGesamt * i.strompreis;
          maintCostA = 400;
          investA = 0;
          break;
        case 'strom':
          techAName = 'Nachtspeicher (aktuell)';
          techAIcon = '‚ö°';
          fuelCostA = 0;
          elecCostA = (stromGesamt + waermebedarf) * i.preisA;
          maintCostA = 100;
          investA = 0;
          break;
      }

      // ========== TECHNOLOGY B ==========
      let elecCostB = 0, feedInB = 0, maintCostB = 0, investB = 0;
      let techBName = '', techBIcon = '';
      let wpStrombedarf = 0;
      let foerderungBetrag = 0;
      let investBrutto = 0;
      
      // KfW max. f√∂rderf√§hige Kosten: 30.000‚Ç¨ f√ºr 1. Wohneinheit
      const maxFoerderfaehig = 30000;
      
      switch(selectedTechB) {
        case 'pv_only':
          // PV-Anlage only - keep existing heating, just add solar
          techBName = 'Nur PV-Anlage';
          techBIcon = '‚òÄÔ∏è';
          
          // PV production adjusted for roof
          const pvProdOnlyBase = i.pvGroesse * 1050 * pvFaktor;
          
          // Self-consumption for household electricity only (not heating)
          let evQuoteOnly = 0.30;
          if (stromGesamt > 0) {
            evQuoteOnly = Math.min(0.70, 0.25 + 0.25 * (stromGesamt / pvProdOnlyBase));
          }
          evQuoteOnly += Math.min(0.2, i.batterie * 0.04);
          
          const evOnly = Math.min(pvProdOnlyBase * evQuoteOnly, stromGesamt);
          const einspeisungOnly = pvProdOnlyBase - evOnly;
          const netzbezugOnly = stromGesamt - evOnly;
          
          // Still need to pay for heating fuel (same as Tech A)
          elecCostB = netzbezugOnly * i.strompreis + fuelCostA; // Electricity + heating fuel
          feedInB = -einspeisungOnly * 0.082;
          maintCostB = 100; // Just PV maintenance
          // Use user-provided costs
          investBrutto = i.pvKosten + i.batterieKosten;
          foerderungBetrag = 0; // No KfW subsidy for PV-only
          investB = investBrutto;
          break;
        case 'wp':
          techBName = 'W√§rmepumpe';
          techBIcon = 'üå°Ô∏è';
          wpStrombedarf = waermebedarf / effectiveCOP;
          elecCostB = (stromGesamt + wpStrombedarf) * i.strompreis;
          feedInB = 0;
          maintCostB = 200;
          // Use user-provided WP cost
          investBrutto = i.wpKosten;
          // F√∂rderung nur auf WP-Kosten (max. 30k f√∂rderf√§hig)
          foerderungBetrag = Math.min(investBrutto, maxFoerderfaehig) * i.foerderung;
          investB = investBrutto - foerderungBetrag;
          if (i.foerderung > 0) techBName += ' (mit F√∂rderung)';
          break;
        case 'wp_pv':
          techBName = 'W√§rmepumpe + PV';
          techBIcon = '‚òÄÔ∏èüå°Ô∏è';
          wpStrombedarf = waermebedarf / effectiveCOP;
          const stromTotal = stromGesamt + wpStrombedarf;
          
          // PV production (S√ºddeutschland ~1050 kWh/kWp, adjusted for roof)
          const pvProduktion = i.pvGroesse * 1050 * pvFaktor;
          
          // Self-consumption model
          let eigenverbrauchQuote = 0.30;
          if (stromTotal > 0) {
            eigenverbrauchQuote = Math.min(0.75, 0.25 + 0.25 * (stromTotal / pvProduktion));
          }
          eigenverbrauchQuote += Math.min(0.2, i.batterie * 0.04);
          
          const eigenverbrauch = Math.min(pvProduktion * eigenverbrauchQuote, stromTotal);
          const einspeisung = pvProduktion - eigenverbrauch;
          const netzbezug = stromTotal - eigenverbrauch;
          
          elecCostB = netzbezug * i.strompreis;
          feedInB = -einspeisung * 0.082; // Einspeiseverg√ºtung
          maintCostB = 250;
          
          // WP costs (f√∂rderf√§hig) + PV costs (nicht f√∂rderf√§hig via KfW Heizung)
          // Use user-provided costs
          foerderungBetrag = Math.min(i.wpKosten, maxFoerderfaehig) * i.foerderung;
          investBrutto = i.wpKosten + i.pvKosten + i.batterieKosten;
          investB = investBrutto - foerderungBetrag;
          if (i.foerderung > 0) techBName += ' (mit F√∂rderung)';
          break;
        case 'gas_neu':
          techBName = 'Gas-Brennwert (neu)';
          techBIcon = 'üî•';
          const gasBedarfNeu = waermebedarf / 0.98;
          elecCostB = gasBedarfNeu * 0.12 + stromGesamt * i.strompreis;
          feedInB = 0;
          maintCostB = 180;
          investB = 12000;
          investBrutto = investB;
          // Keine F√∂rderung f√ºr Gasheizungen
          break;
        case 'pellets_neu':
          techBName = 'Pelletheizung (neu)';
          techBIcon = 'ü™µ';
          const pelletBedarfNeu = waermebedarf / 5 / 0.92;
          elecCostB = pelletBedarfNeu * 0.35 + stromGesamt * i.strompreis;
          feedInB = 0;
          maintCostB = 350;
          investBrutto = 25000;
          // Pellets: auch f√∂rderf√§hig mit √§hnlichen S√§tzen
          foerderungBetrag = Math.min(investBrutto, maxFoerderfaehig) * i.foerderung * 0.5; // geringere F√∂rderung f√ºr Biomasse
          investB = investBrutto - foerderungBetrag;
          if (i.foerderung > 0 && foerderungBetrag > 0) techBName += ' (mit F√∂rderung)';
          break;
      }

      // ========== 20 YEAR CALCULATION ==========
      let totalA = investA;
      let totalB = investB;
      const cashflowA = [];
      const cashflowB = [];
      
      for (let y = 0; y < years; y++) {
        const preisFaktor = Math.pow(1 + i.preissteigerung, y);
        
        const jahresA = (fuelCostA + elecCostA + maintCostA) * preisFaktor;
        totalA += jahresA;
        cashflowA.push(totalA);
        
        const jahresB = (elecCostB + feedInB + maintCostB) * preisFaktor;
        totalB += jahresB;
        cashflowB.push(totalB);
      }

      const savings = totalA - totalB;
      const payback = cashflowA.findIndex((a, idx) => a > cashflowB[idx]) + 1 || years + 1;

      // ========== UPDATE UI ==========
      document.getElementById('techBName').textContent = techBName;
      
      const savingsEl = document.getElementById('totalSavings');
      savingsEl.textContent = (savings >= 0 ? '+' : '') + fmt(savings) + ' ‚Ç¨';
      savingsEl.className = 'savings-value ' + (savings >= 0 ? 'positive' : 'negative');
      
      document.getElementById('savingsNote').textContent = 
        savings >= 0 
          ? `Das entspricht ${fmt(savings / years)} ‚Ç¨ pro Jahr`
          : `${techAName} ist √ºber 20 Jahre ${fmt(-savings)} ‚Ç¨ g√ºnstiger`;

      // Tech A details
      document.getElementById('iconA').textContent = techAIcon;
      document.getElementById('titleA').textContent = techAName;
      document.getElementById('fuelCostA').textContent = fmt(fuelCostA) + ' ‚Ç¨';
      document.getElementById('elecCostA').textContent = fmt(elecCostA) + ' ‚Ç¨';
      document.getElementById('maintCostA').textContent = fmt(maintCostA) + ' ‚Ç¨';
      document.getElementById('investA').textContent = fmt(investA) + ' ‚Ç¨';
      document.getElementById('totalA').textContent = fmt(totalA) + ' ‚Ç¨';

      // Tech B details
      document.getElementById('iconB').textContent = techBIcon;
      document.getElementById('titleB').textContent = techBName;
      document.getElementById('elecCostB').textContent = fmt(elecCostB) + ' ‚Ç¨';
      document.getElementById('feedInB').textContent = fmt(feedInB) + ' ‚Ç¨';
      document.getElementById('maintCostB').textContent = fmt(maintCostB) + ' ‚Ç¨';
      document.getElementById('investBrutto').textContent = fmt(investBrutto) + ' ‚Ç¨';
      document.getElementById('foerderungBetrag').textContent = '-' + fmt(foerderungBetrag) + ' ‚Ç¨';
      document.getElementById('foerderungRow').style.display = foerderungBetrag > 0 ? 'flex' : 'none';
      document.getElementById('investB').textContent = fmt(investB) + ' ‚Ç¨';
      document.getElementById('totalB').textContent = fmt(totalB) + ' ‚Ç¨';

      // Recommendation
      const recIcon = document.getElementById('recIcon');
      const recTitle = document.getElementById('recTitle');
      const recText = document.getElementById('recText');
      
      if (savings > 10000) {
        recIcon.textContent = 'üéâ';
        recTitle.textContent = 'Klare Empfehlung: ' + techBName;
        recText.textContent = `Die Investition amortisiert sich nach etwa ${payback} Jahren. Danach sparst du jedes Jahr bares Geld. Zus√§tzlich profitierst du von F√∂rdermitteln (bis zu 70% bei W√§rmepumpen m√∂glich) und reduzierst deinen CO‚ÇÇ-Aussto√ü erheblich.`;
      } else if (savings > 0) {
        recIcon.textContent = 'üëç';
        recTitle.textContent = techBName + ' lohnt sich';
        recText.textContent = `Die Ersparnis ist moderat, aber √ºber 20 Jahre summiert sie sich. Pr√ºfe aktuelle F√∂rderprogramme (BAFA, KfW), die die Wirtschaftlichkeit weiter verbessern k√∂nnen.`;
      } else {
        recIcon.textContent = 'ü§î';
        recTitle.textContent = 'Abw√§gungssache';
        recText.textContent = `Rein wirtschaftlich ist ${techAName} g√ºnstiger. Allerdings k√∂nnen F√∂rdermittel, CO‚ÇÇ-Einsparungen und steigende Energiepreise das Bild ver√§ndern. Eine Vor-Ort-Beratung lohnt sich.`;
      }

      // Draw chart
      drawChart(cashflowA, cashflowB, techAName, techBName);

      // Go to results
      currentStep = 4;
      updateProgress();
    }

    function fmt(n) {
      return Math.round(n).toLocaleString('de-DE');
    }

    function drawChart(cfA, cfB, nameA, nameB) {
      const ctx = document.getElementById('comparisonChart').getContext('2d');
      
      if (comparisonChart) comparisonChart.destroy();
      
      comparisonChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({length: 20}, (_, i) => i + 1),
          datasets: [
            {
              label: nameA,
              data: cfA,
              borderColor: '#f97316',
              backgroundColor: 'rgba(249, 115, 22, 0.1)',
              fill: true,
              tension: 0.3,
              borderWidth: 3,
            },
            {
              label: nameB,
              data: cfB,
              borderColor: '#10b981',
              backgroundColor: 'rgba(16, 185, 129, 0.1)',
              fill: true,
              tension: 0.3,
              borderWidth: 3,
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: { color: '#9ca3af', font: { family: 'DM Sans', size: 12 } }
            }
          },
          scales: {
            x: {
              grid: { color: 'rgba(55, 65, 81, 0.5)' },
              ticks: { color: '#9ca3af' },
              title: { display: true, text: 'Jahre', color: '#6b7280' }
            },
            y: {
              grid: { color: 'rgba(55, 65, 81, 0.5)' },
              ticks: { 
                color: '#9ca3af',
                callback: v => (v/1000).toFixed(0) + 'k ‚Ç¨'
              }
            }
          }
        }
      });
    }

    // Initialize
    updateTechAUI();
    updateTechBUI();
  </script>
</body>
</html>
